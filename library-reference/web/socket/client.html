
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="robots" content="index, follow">
<meta name='description' content='aardio 编程语言文档 - web.socket.client 库模块帮助文档'>
<meta http-equiv='content-language' content='zh-cn'>
<title>aardio 编程语言文档 - web.socket.client 库模块帮助文档</title> 
<link rel="stylesheet" href="../../../css/markdown.css" tppabs="https://www.aardio.com/zh-cn/doc/css/markdown.css">
<script src="../../../js/prism.js" tppabs="https://www.aardio.com/zh-cn/doc/js/prism.js"></script>
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css">
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css">
</head>
<body class="markdown-body"><a id="back-to-home" href="../../../index.htm" tppabs="https://www.aardio.com/zh-cn/doc/" title="aardio 编程语言文档首页"><i class="fas fa-home" id="home-icon"></i><i class="fas fa-robot" id="ai-icon" style="display: none;"></i><span id="aardio-document-home">aardio 文档</span></a>
<h1>web.socket.client 库模块帮助文档</h1>

<p><a id="web.socket.client"></a></p>

<h2>web.socket.client 成员列表</h2>

<p>支持单线程异步的 WebSocket 客户端<br>
可直接在界面线程中使用，不会阻塞界面，不需要创建多线程<br>
支持服务端心跳(Ping/Pong帧)，客户端单向心跳(Pong帧)机制,<br>
可调用 close 函数断线，并可调用 connect 函数实现重析连接服务器</p>

<p><a id="web.socket.client.getSecAccept"></a></p>

<h3>web.socket.client.getSecAccept()</h3>

<p>获取WebSocket客户端配对密钥，<br>
参数指定服务端HTTP头中sec-websocket-accept返回的值</p>

<p><a id="web.socket.client.getSecKey"></a></p>

<h3>web.socket.client.getSecKey()</h3>

<p>获取WebSocket客户端密钥</p>

<p><a id="web.socket.client.sha1"></a></p>

<h3>web.socket.client.sha1()</h3>

<p>使用sha1算法取哈希值，并使用Base64编码为普通文本</p>

<p><a id="web.socket"></a></p>

<h2>web.socket 成员列表</h2>

<p>纯 aardio 代码实现的轻量 WebSocket 组件。<br>
仅支持 ws 协议，改用 web.SocketSharp 可支持 wss 协议</p>

<p><a id="web.socket.client"></a></p>

<h3>web.socket.client()</h3>

<p><a href="#websocketclientObject">返回对象:websocketclientObject</a></p>

<p><a id="websocketclientObject"></a></p>

<h2>websocketclientObject 成员列表</h2>

<p><a id="websocketclientObject._translateMessage"></a></p>

<h3>websocketclientObject._translateMessage</h3>

<p>此回调函数的参数与onMessage相同,<br>
如果定义了这个回调函数,<br>
那么此函数将在调用onMessage以后被调用,<br>
这个函数提供了一个机会用于自动处理服务器消息<br>
,为其他需要扩展web.socket.client功能的库所预留，<br>
一旦定义将不能修改</p>

<p><a id="websocketclientObject.close"></a></p>

<h3>websocketclientObject.close()</h3>

<p>关闭连接<br>
可选增加2个参数指定发送给服务器的关闭帧附加数据:<br>
参数@1为数值类型的错误代码,参数@2为字符串类型错误描述</p>

<p><a id="websocketclientObject.connect"></a></p>

<h3>websocketclientObject.connect(&quot;ws://&quot;)</h3>

<p>重新连接到WebSocket服务端<br>
参数指定WebSocket服务端网址，例如 &quot;ws://localhost:7511&quot;<br>
如果不指定参数,则获取上次调用此函数指定的网址参数,<br>
如果之前也没有指定网址则抛出异常</p>

<p><a id="websocketclientObject.headers"></a></p>

<h3>websocketclientObject.headers</h3>

<p>其他HTTP请求头<br>
值可以是文本或数组、或键值对组成的表<br>
请求时会调用 web.joinHeaders()函数拼接并转换HTTP头<br>
该函数支持的类型和格式这个属性都可以支持</p>

<p><a id="websocketclientObject.heartbeatData"></a></p>

<h3>websocketclientObject.heartbeatData</h3>

<p>单向心跳发送的数据,默认为空数据<br>
这个值修改以后，只能在下次调用connect函数才会生效</p>

<p><a id="websocketclientObject.heartbeatInterval"></a></p>

<h3>websocketclientObject.heartbeatInterval</h3>

<p>客户端主动发送心跳间隔,默认为30秒,<br>
设为-1时禁用客户端心跳,注意某些服务端收到心跳包会报错,这时建议关掉心跳,<br>
此属性值修改以后，只能在下次调用connect函数才会生效</p>

<p><a id="websocketclientObject.heartbeatType"></a></p>

<h3>websocketclientObject.heartbeatType</h3>

<p>单向心跳发送的的帧类型,<br>
默认为0xA,也就是单向心跳 Pong 帧<br>
这个值修改以后，只能在下次调用connect函数才会生效</p>

<p><a id="websocketclientObject.isClosed"></a></p>

<h3>websocketclientObject.isClosed()</h3>

<p>套接字是否已关闭</p>

<p><a id="websocketclientObject.isConnected"></a></p>

<h3>websocketclientObject.isConnected()</h3>

<p>套接字是否已连接并准备就绪(已与服务器握手成功)</p>

<p><a id="websocketclientObject.onClose"></a></p>

<h3>websocketclientObject.onClose</h3>

<pre><code class="aardio language-aardio">websocketclientObject.onClose = function(e){
    /*连接被关闭  
e.code为错误代码e.reason为错误原因*/  
}
</code></pre>

<p><a id="websocketclientObject.onError"></a></p>

<h3>websocketclientObject.onError</h3>

<pre><code class="aardio language-aardio">websocketclientObject.onError = function(err){
    /*发生错误,err为错误信息*/
}
</code></pre>

<p><a id="websocketclientObject.onFragment"></a></p>

<h3>websocketclientObject.onFragment</h3>

<pre><code class="aardio language-aardio">websocketclientObject.onFragment = function(msg){
   /*收到分片数据  
第一个数据包使用msg.type指明类型,参考WebSocket协议规范  
后续数据包msg.type为0,最后一个数据包msg.fin为1  

如果不指定这个回调函数,则自动并接分片数据后触发onMessage事件*/ 
}
</code></pre>

<p><a id="websocketclientObject.onMessage"></a></p>

<h3>websocketclientObject.onMessage</h3>

<pre><code class="aardio language-aardio">websocketclientObject.onMessage = function(msg){
    /*收到服务端数据  
msg.type为1时msg.data为文本,  
否则msg.data为字节数组（buffer类型）*/

}
</code></pre>

<p><a id="websocketclientObject.onOpen"></a></p>

<h3>websocketclientObject.onOpen</h3>

<pre><code class="aardio language-aardio">websocketclientObject.onOpen = function(){
    websocketclientObject.send(&quot;已连接到WebSocket服务&quot;);
}
</code></pre>

<p><a id="websocketclientObject.originUrl"></a></p>

<h3>websocketclientObject.originUrl</h3>

<p>浏览器启动WebSocket客户端的网址<br>
一些WebSocket服务器根据这个判断是不是允许连接,<br>
所以有时候设置这个很重要<br>
默认使用WebSocket网址，并把 前面的ws://改为http://</p>

<p><a id="websocketclientObject.protocol"></a></p>

<h3>websocketclientObject.protocol</h3>

<p>应用程序支持的协议列表,默认为&quot;chat&quot;</p>

<p><a id="websocketclientObject.readyState"></a></p>

<h3>websocketclientObject.readyState</h3>

<p>连接状态,<br>
0为等待连接,1为已连接并准备就绪,2为正在关闭,3为已关闭<br>
只有成功通过WebSocket协议握手以后readyState才会被置为1<br>
这与socket.readyState连接成功就会置为1是不同的</p>

<p><a id="websocketclientObject.responseHeaders"></a></p>

<h3>websocketclientObject.responseHeaders</h3>

<p>服务端响应的HTTP头<br>
这是一个表对象，键名都已转为小写</p>

<p><a id="websocketclientObject.secKey"></a></p>

<h3>websocketclientObject.secKey</h3>

<p>连接密钥,不可改动</p>

<p><a id="websocketclientObject.send"></a></p>

<h3>websocketclientObject.send()</h3>

<p>发送数据,支持字符串或 buffer、结构体<br>
字符串作为UTF8文本类型发送,其他以二进制类型发送，<br>
成功返回true</p>

<p><a id="websocketclientObject.sendData"></a></p>

<h3>websocketclientObject.sendData(data,opcode,fin,mask,rsv1,rsv2,rsv3)</h3>

<p>发送WebSocket数据包<br>
参数@1支持支持字符串或 buffer、结构体<br>
除参数@1以外,所以参数可选<br>
一般应当调用send函数，而不是调用sendData函数  </p>

<p>如果一定要使用这个函数,请阅读此函数源码,以及WebSocket协议相关说明</p>

<p><a id="websocketclientObject.socket"></a></p>

<h3>websocketclientObject.socket</h3>

<p>异步套接字对象<br>
在关闭连接状态下此属性的值为null<br>
应由对象自动打开或删除套接字对象，调用者不可改动此属性的值  </p>

<p><a href="../../wsock/tcp/asynClient.html#tcpaclientObject" tppabs="https://www.aardio.com/zh-cn/doc/library-reference/wsock/tcp/asynClient.html#tcpaclientObject">返回对象:tcpaclientObject</a></p>

<p><a id="websocketclientObject.url"></a></p>

<h3>websocketclientObject.url</h3>

<p>上次成功连接的网址<br>
也可以用于指定下次连接的默认网址</p>

<p><a id="websocketclientObject.userAgent"></a></p>

<h3>websocketclientObject.userAgent</h3>

<p>客户端应用程序代理头<br>
默认为&quot;Mozilla/5.0&quot;</p>

<p><a id="websocketclientObject.waitForConnected"></a></p>

<h3>websocketclientObject.waitForConnected(关联窗口句柄,超时)</h3>

<p>等待连接到WebSocket服务端<br>
所有参数可选,超时以毫秒为单位,  </p>

<p>连接成功返回true,失败返回false或null</p>

<p><a href="client.md" tppabs="https://www.aardio.com/zh-cn/doc/library-reference/web/socket/client.md">Markdown 格式</a></p>

</body> 
</html>