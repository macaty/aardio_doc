
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="robots" content="index, follow">
<meta name='description' content='aardio 编程语言文档 - web.socket.jsonServer 库模块帮助文档'>
<meta http-equiv='content-language' content='zh-cn'>
<title>aardio 编程语言文档 - web.socket.jsonServer 库模块帮助文档</title> 
<link rel="stylesheet" href="../../../css/markdown.css" tppabs="https://www.aardio.com/zh-cn/doc/css/markdown.css">
<script src="../../../js/prism.js" tppabs="https://www.aardio.com/zh-cn/doc/js/prism.js"></script>
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css">
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css">
</head>
<body class="markdown-body"><a id="back-to-home" href="../../../index.htm" tppabs="https://www.aardio.com/zh-cn/doc/" title="aardio 编程语言文档首页"><i class="fas fa-home" id="home-icon"></i><i class="fas fa-robot" id="ai-icon" style="display: none;"></i><span id="aardio-document-home">aardio 文档</span></a>
<h1>web.socket.jsonServer 库模块帮助文档</h1>

<p><a id="web.socket"></a></p>

<h2>web.socket 成员列表</h2>

<p><a id="web.socket.jsonServer"></a></p>

<h3>web.socket.jsonServer</h3>

<p>创建WebSocket/JSON-RPC 2.0服务端</p>

<p><a id="web.socket.jsonServer"></a></p>

<h3>web.socket.jsonServer()</h3>

<p><a href="#websocketjsonserverObject">返回对象:websocketjsonserverObject</a></p>

<p><a id="web.socket.jsonServer"></a></p>

<h3>web.socket.jsonServer(wsServer,external)</h3>

<p>创建WebSocket/JSON-RPC 2.0服务端<br>
参数@1应当是一个 web.socket.server对象<br>
参数@2指定客户端可以调用的表对象<br>
external也可以在创建对象以后,使用对象的external属性指定</p>

<p><a id="websocketjsonserverObject"></a></p>

<h2>websocketjsonserverObject 成员列表</h2>

<p><a id="websocketjsonserverObject.aasdl"></a></p>

<h3>websocketjsonserverObject.aasdl</h3>

<p>指定自定义的aasdl<br>
如果客户端请求的方法名为&quot;?&quot;时,返回此属性,<br>
<a href="../../../../../../github.com/aardio/aardio-js/blob/master/AASDL.md" tppabs="https://github.com/aardio/aardio-js/blob/master/AASDL.md">关于aasdl</a></p>

<p><a id="websocketjsonserverObject.afterJsonStringify"></a></p>

<h3>websocketjsonserverObject.afterJsonStringify</h3>

<pre><code class="aardio language-aardio">websocketjsonserverObject.afterJsonStringify = function(jsonData){
    /*可以在这里加密服务端数据,返回null中止本次调用*/
    return jsonData;
}
</code></pre>

<p><a id="websocketjsonserverObject.beforeJsonParse"></a></p>

<h3>websocketjsonserverObject.beforeJsonParse</h3>

<pre><code class="aardio language-aardio">websocketjsonserverObject.beforeJsonParse = function(hSocket,jsonData){
    /*可以在这里解密客户端数据,返回null中止本次调用*/
    return jsonData;
}
</code></pre>

<p><a id="websocketjsonserverObject.external"></a></p>

<h3>websocketjsonserverObject.external</h3>

<p>指定包含客户端可以调用的远程函数的表对象,可嵌套子表  </p>

<p>如果远程函数名第一个字符是$,则第一个回调参数为hSocket,用于表示当前发送请求的客户端套接字,  </p>

<p>如果客户端请求方法名为&quot;?&quot;时，并且服务端没有指定aasdl属性<br>
服务端会根据aasdl协议将对象序列化为json并返回客户端，<br>
<a href="../../../../../../github.com/aardio/aardio-js/blob/master/AASDL.md" tppabs="https://github.com/aardio/aardio-js/blob/master/AASDL.md">关于aasdl</a></p>

<p><a id="websocketjsonserverObject.hActiveSocket"></a></p>

<h3>websocketjsonserverObject.hActiveSocket</h3>

<p>获取当前活动的客户端套接字句柄,<br>
应当在RPC回调的第一句代码中获取此句柄,<br>
因为执行其他代码都有可能导致其他客户端变为活动客户端</p>

<p><a id="websocketjsonserverObject.isClosed"></a></p>

<h3>websocketjsonserverObject.isClosed(hSocket)</h3>

<p>连接是否已关闭</p>

<p><a id="websocketjsonserverObject.isConnected"></a></p>

<h3>websocketjsonserverObject.isConnected(hSocket)</h3>

<p>是否已连接并准备就绪可以发送数据</p>

<p><a id="websocketjsonserverObject.notify"></a></p>

<h3>websocketjsonserverObject.notify(hSocket,method,...)</h3>

<p>主动向客户端发送通知<br>
参数hSocket指定客户端套接字句柄,<br>
method指定客户端方法名,<br>
可添加任意个调用参数</p>

<p><a id="websocketjsonserverObject.publish"></a></p>

<h3>websocketjsonserverObject.publish(method,...)</h3>

<p>主动向所有客户端发送通知<br>
method指定客户端方法名,<br>
可添加任意个调用参数</p>

<p><a id="websocketjsonserverObject.send"></a></p>

<h3>websocketjsonserverObject.send(hSocket,rep)</h3>

<p>对指定的套接字发送数据,<br>
参数hSocket指定客户端套接字句柄,<br>
rep应当是符合JSON-RPC 2.0编码协议的响应对象<br>
不建议直接调用此函数发送消息</p>

<p><a id="websocketjsonserverObject.start"></a></p>

<h3>websocketjsonserverObject.start(hSocket)</h3>

<p>对指定的套接字启动JSON-RPC服务<br>
参数hSocket指定客户端套接字句柄,<br>
hSocket参数必须在web.socket.server服务端对象<br>
的onUpgradeToWebsocket事件中获取</p>

<p><a id="websocketjsonserverObject.survey"></a></p>

<h3>websocketjsonserverObject.survey(method,...)</h3>

<p>发起调查任务,<br>
调用所有客户端的同名函数,<br>
method指定客户端方法名,<br>
可添加任意个调用参数  </p>

<p>客户端会触发xcallback的成员函数，<br>
请参考xcallback的说明</p>

<p><a id="websocketjsonserverObject.version"></a></p>

<h3>websocketjsonserverObject.version</h3>

<p>JSON-RPC版本号，不应改动</p>

<p><a id="websocketjsonserverObject.wsServer"></a></p>

<h3>websocketjsonserverObject.wsServer</h3>

<p>web.socket.server服务端对象</p>

<p><a id="websocketjsonserverObject.xcall"></a></p>

<h3>websocketjsonserverObject.xcall(hSocket,method,...)</h3>

<p>主动调用客户端函数<br>
参数hSocket指定客户端套接字句柄,<br>
method指定客户端方法名,<br>
可添加任意个调用参数  </p>

<p>客户端会触发xcallback的成员函数，<br>
请参考xcallback的说明</p>

<p><a id="websocketjsonserverObject.web.socket"></a></p>

<h2>websocketjsonserverObject.web.socket 成员列表</h2>

<p><a id="websocketjsonserverObject.web.socket.jsonServer"></a></p>

<h3>websocketjsonserverObject.web.socket.jsonServer</h3>

<p>创建WebSocket/JSON-RPC 2.0服务端</p>

<p><a id="websocketjsonserverObject.xcallback"></a></p>

<h2>websocketjsonserverObject.xcallback 成员列表</h2>

<p>服务端通过xcall函数调用客户端函数时<br>
客户端如果返回应答会自动回调xcallback的成员函数</p>

<p><a id="websocketjsonserverObject.xcallback.?"></a></p>

<h3>websocketjsonserverObject.xcallback.?</h3>

<pre><code class="aardio language-aardio">websocketjsonserverObject.xcallback./*出错时err为错误对象,  
否则result为客户端返回的值  
hSocket为客户端套接字*/ = function(hSocket,result,err){

}
</code></pre>

<p><a href="jsonServer.md" tppabs="https://www.aardio.com/zh-cn/doc/library-reference/web/socket/jsonServer.md">Markdown 格式</a></p>

</body> 
</html>